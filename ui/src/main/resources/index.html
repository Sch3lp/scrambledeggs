<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>Elm â€¢ TodoMVC</title>
    <script type="text/javascript" src="/main.js"></script>
    <!-- <link rel="stylesheet" href="style.css" type="text/css"> -->
</head>

<body>
</body>

<script type="text/javascript">
    var app = Elm.Main.init({ flags: rememberedBytes() });
    /* Fetch back generated bytes from the local storage */
    function rememberedBytes() {
        const bytes = localStorage.getItem("scrambled_bytes");
        return bytes ? bytes.split(",").map(x => parseInt(x,10)) : null;
    }

    /* Generate high entropy random bytes using the Web Crypto API and
    remember them so that they are preserved between redirections. This
    allows to protect for XSS & authorization code attacks */
    app.ports.genRandomBytes.subscribe(n => {
        const buffer = new Uint8Array(n);
        crypto.getRandomValues(buffer);
        const bytes = Array.from(buffer);
        localStorage.setItem("scrambled_bytes", bytes);
        app.ports.randomBytes.send(bytes);
    });
</script>

</html>